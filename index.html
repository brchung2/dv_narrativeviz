<!DOCTYPE html>
<html>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
	
    <style type="text/css">
	#tooltip {
	    opacity: 0;
	    position: absolute;
	    text-align: center;
	    width: 60px; height: 40px;
	    background: white;
	    border: 0px;
	}


    </style>   
    
<body onload='init()'> 
	
<div id="tooltip"></div>    

<script>

async function init() {
	const data = await d3.csv('emission3.csv');
    	console.log(data);
	
	plotting(data);
}


function plotting(data) {
// 2. Use the margin convention practice 
var margin = {top: 50, right: 50, bottom: 50, left: 50}
  , width = 740 - margin.left - margin.right
  , height = 450 - margin.top - margin.bottom;

// Add svg
var svg = d3.select("body")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
    "translate(" + margin.left + "," + margin.top + ")");


    

//     d3.select('body')
//       .selectAll('p')
//       .data(data)
//       .enter()
//       .append('p')
//       .html(function(d,i) {return 'year ' + d.year+ ' = ' + d.emission ;});

// Add chart title
svg.append("text")
.attr("x", (width / 2))             
.attr("y", 0 - (margin.top / 2))
.attr("text-anchor", "middle")  
.style("font-size", "16px")  
.text("Global CO2 Emissions units");

// Add X axis
var x = d3.scaleLinear()
.domain([1960, 2017])
.range([ 0, width ]);

svg.append("g")
.attr("transform", "translate(0," + height + ")")
.call(d3.axisBottom(x).tickFormat(d3.format("d")));

// text label for the x axis
svg.append("text")             
.attr("transform",
"translate(" + (width/2) + " ," + 
	    (height + margin.top) + ")")
.style("text-anchor", "middle")
.text("Year");
	
 // Add Y axis for Emissions
var y = d3.scaleLinear()
.domain([0, 35])
.range([ height, 0]);

// formatValue = d3.format(".2s");
svg.append("g")
.call(d3.axisLeft(y).tickFormat(d3.format("d")));

// Text label for the Emissions y axis
svg.append("text")
.attr("transform", "rotate(-90)")
.attr("y", 0 - margin.left)
.attr("x",0 - (height / 2))
.attr("dy", "1em")
.style("text-anchor", "middle")
.text("CO2 Emissions - billion metric tons"); 

	
                
// var path = svg.append("path")
// .datum(data.filter(function(d) {return d.year <= 1973;}))
// .attr("fill", "none")
// .attr("stroke", "#4CAF50")
// .attr("stroke-width", 2)
// .attr("d", d3.line()
//     .x(function(d) { return x(d.year) })
//     .y(function(d) { return y(d.WLD) })
// )

// // Animate emissions line
// var pathLength = path.node().getTotalLength();

// path.attr("stroke-dasharray", pathLength)
//     .attr("stroke-dashoffset", pathLength)
//     .transition()
//     .duration(3500) 
//     .ease(d3.easeSin) 
//     .attr("stroke-dashoffset", 0);
	

	
var tooltip = d3.select("#tooltip");
// Add the data lines in line graph:	
// Append path, bind the data, and call the line generator 
// WORLD data in red
svg.append("path")
    .datum(data) 
    .attr("class", "line")
    .attr("d", d3.line()
	    .x(function(d) { return x(d.year); }) 
	    .y(function(d) { return y(d.WLD); }))  
    .attr("fill", "none")
    .attr("stroke", "#ff0000") 
    .attr("stroke-width", 3)
     // WHEN MOUSE OVER
    .on("mouseover", function(d) {
        tooltip.style("opacity", 1)
               .style("left",(d3.event.pageX)+"px")
               .style("top",(d3.event.pageY)+"px")
               .html("Global emissions: "+d.WLD+ "Year: "+ d.year);
    })
// WHEN MOUSE LEAVES THE BAR, OPACITY SET BACK TO 0
    .on("mouseout", function() { tooltip.style("opacity", 0) })
	;

// US data in blue
svg.append("path")
    .datum(data) 
    .attr("class", "line")
    .attr("d", d3.line()
	    .x(function(d) { return x(d.year); }) 
	    .y(function(d) { return y(d.USA); }))  
    .attr("fill", "none")
    .attr("stroke", "#004cff") 
    .attr("stroke-width", 3);

// // Append circle point for each datapoint --> looks too busy. 65 circles on a line...
// svg.selectAll(".dot")
//     .data(data)
//   .enter().append("circle") 
//     .attr("class", "dot") 
//     .attr("cx", function(d) { return x(d.year); })
//     .attr("cy", function(d) { return y(d.WLD); })
//     .attr("r", 5)
//       .on("mouseover", function(a, b, c) { 
//   			console.log(a) 
//         this.attr('class', 'focus')
// 		})
//       .on("mouseout", function() {  })


	
	
}	  

</script>
</body>
</html> 
 
