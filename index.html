<!DOCTYPE html>
<html>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
	
    <style type="text/css">
     .overlay {
        fill: none;
        pointer-events: all;
    }

    .focus circle {
        fill: steelblue;
    }

    .focus text {
        font-size: 14px;
    }

    .tooltip {
        fill: white;
        stroke: #000;
    }

    .tooltip-date, .tooltip-likes {
        font-weight: bold;
	}


    </style>   
    
<body onload='init()'> 
	
<!-- <div id="tooltip"></div>     -->

<script>

async function init() {
	const data = await d3.csv('emission3.csv');
    	console.log(data);
	
	plotting(data);
}


function plotting(data) {
// 2. Use the margin convention practice 
var margin = {top: 50, right: 50, bottom: 50, left: 50}
  , width = 740 - margin.left - margin.right
  , height = 450 - margin.top - margin.bottom;

// Add svg
var svg = d3.select("body")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
    "translate(" + margin.left + "," + margin.top + ")");


    

//     d3.select('body')
//       .selectAll('p')
//       .data(data)
//       .enter()
//       .append('p')
//       .html(function(d,i) {return 'year ' + d.year+ ' = ' + d.emission ;});

// Add chart title
svg.append("text")
.attr("x", (width / 2))             
.attr("y", 0 - (margin.top / 2))
.attr("text-anchor", "middle")  
.style("font-size", "16px")  
.text("Global CO2 Emissions units");

// Add X axis
var x = d3.scaleLinear()
.domain([1960, 2017])
.range([ 0, width ]);

svg.append("g")
.attr("transform", "translate(0," + height + ")")
.call(d3.axisBottom(x).tickFormat(d3.format("d")));

// text label for the x axis
svg.append("text")             
.attr("transform",
"translate(" + (width/2) + " ," + 
	    (height + margin.top) + ")")
.style("text-anchor", "middle")
.text("Year");
	
 // Add Y axis for Emissions
var y = d3.scaleLinear()
.domain([0, 35])
.range([ height, 0]);

// formatValue = d3.format(".2s");
svg.append("g")
.call(d3.axisLeft(y).tickFormat(d3.format("d")));

// Text label for the Emissions y axis
svg.append("text")
.attr("transform", "rotate(-90)")
.attr("y", 0 - margin.left)
.attr("x",0 - (height / 2))
.attr("dy", "1em")
.style("text-anchor", "middle")
.text("CO2 Emissions - billion metric tons"); 

	
                
// var path = svg.append("path")
// .datum(data.filter(function(d) {return d.year <= 1973;}))
// .attr("fill", "none")
// .attr("stroke", "#4CAF50")
// .attr("stroke-width", 2)
// .attr("d", d3.line()
//     .x(function(d) { return x(d.year) })
//     .y(function(d) { return y(d.WLD) })
// )

// // Animate emissions line
// var pathLength = path.node().getTotalLength();

// path.attr("stroke-dasharray", pathLength)
//     .attr("stroke-dashoffset", pathLength)
//     .transition()
//     .duration(3500) 
//     .ease(d3.easeSin) 
//     .attr("stroke-dashoffset", 0);
	

	
// var tooltip = d3.select("body").append("div").attr("class", "tooltip");
// var tooltip = d3.select("body").append("div")
// .attr("class", "tooltip")
// .style("display", "none");    

// var focus = svg.append("g")
// .attr("class", "focus")
// .style("display", "none");

// focus.append("circle")
// .attr("r", 4);
	
// Add the data lines in line graph:	
// Append path, bind the data, and call the line generator 
// WORLD data in red
svg.append("path")
    .datum(data) 
    .attr("class", "line")
    .attr("d", d3.line()
	    .x(function(d) { return x(d.year); }) 
	    .y(function(d) { return y(d.WLD); }))  
    .attr("fill", "none")
    .attr("stroke", "#ff0000") 
    .attr("stroke-width", 3)
	
//         .on("mouseover", function (d) {
//             focus.style("display", null);
//             tooltip.style("display", null);
	
//             tooltip
//                 .style("left", d3.event.pageX - 10 + "px")
//                 .style("top", d3.event.pageY + 20 + "px")
//                 .html("Total area under fire: " + d.WLD + " acres."
//                     + "</br>"
//                     + "Temperture: " + d.year + " &#8451;"
//                 );
//         })
//         .on("mouseout", function (d) {
//             focus.style("display", "none");
//             tooltip.style("display", "none");
//         })
	;

// US data in blue
svg.append("path")
    .datum(data) 
    .attr("class", "line")
    .attr("d", d3.line()
	    .x(function(d) { return x(d.year); }) 
	    .y(function(d) { return y(d.USA); }))  
    .attr("fill", "none")
    .attr("stroke", "#004cff") 
    .attr("stroke-width", 3);

// // Append circle point for each datapoint --> looks too busy. 65 circles on a line...
// svg.selectAll(".dot")
//     .data(data)
//   .enter().append("circle") 
//     .attr("class", "dot") 
//     .attr("cx", function(d) { return x(d.year); })
//     .attr("cy", function(d) { return y(d.WLD); })
//     .attr("r", 5)
//       .on("mouseover", function(a, b, c) { 
//   			console.log(a) 
//         this.attr('class', 'focus')
// 		})
//       .on("mouseout", function() {  })

// create tool tip from: https://bl.ocks.org/Qizly/8f6ba236b79d9bb03a80
 var focus = svg.append("g")
    .attr("class", "focus")
    .style("display", "none");

        focus.append("circle")
            .attr("r", 5);

        focus.append("rect")
            .attr("class", "tooltip")
            .attr("width", 100)
            .attr("height", 50)
            .attr("x", 10)
            .attr("y", -22)
            .attr("rx", 4)
            .attr("ry", 4);

        focus.append("text")
            .attr("class", "tooltip-date")
            .attr("x", 18)
            .attr("y", -2);

        focus.append("text")
            .attr("x", 18)
            .attr("y", 18)
            .text("Likes:");

        focus.append("text")
            .attr("class", "tooltip-likes")
            .attr("x", 60)
            .attr("y", 18);

        svg.append("rect")
            .attr("class", "overlay")
            .attr("width", width)
            .attr("height", height)
            .on("mouseover", function() { focus.style("display", null); })
            .on("mouseout", function() { focus.style("display", "none"); })
            .on("mousemove", mousemove);

	var formatValue = d3.format("d");

	
        function mousemove() {
            var x0 = x.invert(d3.mouse(this)[0]),
                i = bisectDate(data, x0, 1),
                d0 = data[i - 1],
                d1 = data[i],
                d = x0 - d0.year > d1.year - x0 ? d1 : d0;
            focus.attr("transform", "translate(" + x(d.year) + "," + y(d.WLD) + ")");
            focus.select(".tooltip-date").text(formatValue(d.year));
            focus.select(".tooltip-likes").text(formatValue(d.WLD));
        }

	
	
}	  

</script>
</body>
</html> 
 
