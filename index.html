<!DOCTYPE html>
<html>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

    <style type="text/css">
     .overlay {
        fill: none;
        pointer-events: all;
    }

    .focus circle {
        fill: #ff0000;
    }

    .focus text {
        font-size: 14px;
    }

    .tooltip {
        fill: white;
        stroke: #000;
    }

    .tooltip-year, .tooltip-wld {
        font-weight: bold;
	}


    </style>   
    
<body onload='init()'> 
	
<!-- <div id="tooltip"></div>     -->

<script>

// load data
async function init() {
	const data = await d3.csv('emission3.csv');
    	console.log(data);
	
	plotting(data);
}

// code for plotting chart
function plotting(data) {
	
	// =========================== Chart Dimensions ===========================	
	// set line chart dimensions
	var margin = {top: 30, right: 50, bottom: 50, left: 50}
	, width = 740 - margin.left - margin.right
	, height = 450 - margin.top - margin.bottom;

	// add svg canvas dimensions
	var svg = d3.select("body")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


	// Add graph title
	svg.append("text")
	.attr("x", (width / 2))             
	.attr("y", 0 - (margin.top / 2))
	.attr("text-anchor", "middle")  
	.style("font-size", "16px")  
	.text("Global CO2 Emissions units");

	// =========================== Axes ===========================
	// Create X axis
	var x = d3.scaleLinear()
	.domain([1960, 2017])
	.range([ 0, width]);
	
	// Add X axis to svg
	svg.append("g")
	.attr("transform", "translate( 0," + height + ")")
	.call(d3.axisBottom(x).tickFormat(d3.format("d")));

	// Add label to X axis
	svg.append("text")             
	.attr("transform", "translate(" + (width/2) + " ," + (height + (margin.top/2)) + ")")
	.attr("dy", "1em")
	.style("text-anchor", "middle")
	.text("Year");

	
	// Create Y axis
	var y = d3.scaleLinear()
	.domain([0, 35])
	.range([ height, 0]);

	// Add Y axis to svg
	svg.append("g")
	.attr("transform", "translate(0, 0)")
	.call(d3.axisLeft(y).tickFormat(d3.format("d")));

	// Add label to y axis
	svg.append("text")
	.attr("transform", "rotate(-90)")
	.attr("x", 0 - (height / 2))
	.attr("y", 0 - margin.left)
	.attr("dy", "1em")
	.style("text-anchor", "middle")
	.text("CO2 Emissions - billion metric tons"); 

	// =========================== Add data lines to graph ===========================


	// WORLD data in red
	svg.append("path")
	.data(data) 
	.attr("class", "line")
	.attr("d", d3.line()
	.x(function(d) { return x(d.year); }) 
	.y(function(d) { return y(d.WLD); }))  
	.attr("fill", "none")
	.attr("stroke", "#ff0000") 
	.attr("stroke-width", 3);

	// US data in blue
	svg.append("path")
	.data(data) 
	.attr("class", "line")
	.attr("d", d3.line()
	.x(function(d) { return x(d.year); }) 
	.y(function(d) { return y(d.USA); }))  
	.attr("fill", "none")
	.attr("stroke", "#004cff") 
	.attr("stroke-width", 3);

	// // Append circle point for each datapoint --> looks too busy. 65 circles on a line...
	// svg.selectAll(".dot")
	//     .data(data)
	//   .enter().append("circle") 
	//     .attr("class", "dot") 
	//     .attr("cx", function(d) { return x(d.year); })
	//     .attr("cy", function(d) { return y(d.WLD); })
	//     .attr("r", 5)
	//       .on("mouseover", function(a, b, c) { 
	//   			console.log(a) 
	//         this.attr('class', 'focus')
	// 		})
	//       .on("mouseout", function() {  })

	
	
	// =========================== Tooltip ===========================
	// source from: https://bl.ocks.org/Qizly/8f6ba236b79d9bb03a80


	var focus = svg.append("g")
	.attr("class", "focus")
	.style("display", "none");

	focus.append("circle")
	.attr("r", 5);

	focus.append("rect")
	.attr("class", "tooltip")
	.attr("width", 100)
	.attr("height", 50)
	.attr("x", 10)
	.attr("y", -22)
	.attr("rx", 4)
	.attr("ry", 4);

	focus.append("text")
	.attr("class", "tooltip-year")
	.attr("x", 18)
	.attr("y", -2);

	focus.append("text")
	.attr("x", 18)
	.attr("y", 18)
	.text("Global Emissions: ");

	focus.append("text")
	.attr("class", "tooltip-wld")
	.attr("x", 60)
	.attr("y", 18);

	svg.append("rect")
	.attr("class", "overlay")
	.attr("width", width)
	.attr("height", height)
	.on("mouseover", function() { focus.style("display", null); })
	.on("mouseout", function() { focus.style("display", "none"); })
	.on("mousemove", mousemove);

	var formatValue = d3.format("d");


	function mousemove() {
	var x0 = x.invert(d3.mouse(this)[0]);
	bisectYear = d3.bisector(function(a, b){ return a.year - b; }).right;
	var i = bisectYear(data, x0),
	d0 = data[i - 1],
	d1 = data[i],
	d = x0 - d0.year > d1.year - x0 ? d1 : d0;
	focus.attr("transform", "translate(" + x(d.year) + "," + y(d.WLD) + ")");
	focus.select(".tooltip-year").text(formatValue(d.year));
	focus.select(".tooltip-wld").text(formatValue(d.WLD));
	}

	
	
}	  

</script>
</body>
</html> 
 
